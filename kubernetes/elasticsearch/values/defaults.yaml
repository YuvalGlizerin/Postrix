# Minimum single-node Elasticsearch with Kibana setup
elasticsearch:
  # Master node configuration - essential settings
  master:
    masterOnly: false
    replicaCount: 1
    resources:
      limits:
        cpu: 1000m
        memory: 1500Mi
      requests:
        cpu: 100m
        memory: 750Mi
    persistence:
      enabled: true
      storageClass: gp3-elasticsearch
      size: 2Gi
    
  # Disable additional nodes for minimal setup
  data:
    replicaCount: 0
  coordinating:
    replicaCount: 0
  ingest:
    replicaCount: 0

  # Core settings
  security:
    enabled: true
    existingSecret: elasticsearch-auth # This is the sealed secret that should have the key elasticsearch-password
    tls:
      # Simplest option - auto-generate certificates
      autoGenerated: true

  # Add Elasticsearch ingress to allow external access
  ingress:
    enabled: true
    hostname: elasticsearch.postrix.io
    ingressClassName: nginx
    path: /
    pathType: Prefix
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"

  # Kibana configuration
  global:
    kibanaEnabled: true

  kibana:
    elasticsearch:
      hosts: ["elasticsearch"]
      security:
        auth:
          enabled: true
          createSystemUser: true
          kibanaPassword: elasticsearch # This is just for system user creation(if omitted an error will be thrown), this will not be the password
          elasticsearchPasswordSecret: elasticsearch-auth # This is the sealed secret that should have the key elasticsearch-password
        tls:
          # Enable TLS for Kibana to connect to Elasticsearch
          enabled: true
          usePemCerts: true
          existingSecret: elasticsearch-master-crt
    
    resources:
      limits:
        cpu: 1000m
        memory: 1500Mi
      requests:
        cpu: 100m
        memory: 750Mi
        
    persistence:
      enabled: true
      storageClass: gp3-kibana
      size: 1Gi
      
    ingress:
      enabled: true
      hostname: kibana.postrix.io
      ingressClassName: nginx
